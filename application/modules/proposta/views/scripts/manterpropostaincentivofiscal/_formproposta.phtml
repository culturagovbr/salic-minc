<?php $buscarAgencia = $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaincentivofiscal', 'action' => 'validaagencia')); ?>

<style type="text/css">
    .divChave{}
    .divNaoChave{}
    label {
        margin-right: 5px;
        font-weight: normal;
    }

    .error{ color:red; font-weight: normal; }

    #conteudo table,
    table.tabela {
        width: 99%;
        margin: 10px auto;
    }

    form > table:first-of-type {
        margin-top: 0px !important;
    }


</style>


<div class="container-fluid">
    <div class="row">
        <?php
            if (isset($this->proposta['idPreProjeto'])) {
                echo $this->partial("inc/menu.phtml", $this); // menu
            }

            $currentUrl = Zend_Controller_Front::getInstance()->getRequest()->getRequestUri();
        ?>

        <div class="col <?php echo isset($this->proposta['idPreProjeto']) ? 's10 m12 l10 ': 's12 m12 l12 '?>">
            <?php
            gerarBreadCrumb(array(
                array('Lista de Propostas' => array('controller' => 'manterpropostaincentivofiscal', 'action' => 'listarproposta')),
                array('Proposta' => '')
            ));
            ?>

    <!--        <div id="msgExclusaoArq" class="sumir">Deseja realmente efetuar a exclus&atilde;o do arquivo?</div>-->

            <!-- ========== INICIO TITULO ========== -->
            <div id="titulo">
                <div><?php if (!isset($this->proposta['idPreProjeto'])) { echo "NOVA"; } ?> PROPOSTA <?php //echo montaBotaoVoltar($controller, $links); ?></div>
            </div>

    <!--        <script type="text/javascript" src="--><?php //echo $this->baseUrl(); ?><!--/public/js/ckeditor/ckeditor.js"></script>-->
    <!--        <script type="text/javascript" src="--><?php //echo $this->baseUrl(); ?><!--/public/js/ckeditor/_samples/sample.js"></script>-->
    <!--        <link type="text/css" rel="stylesheet" href="--><?php //echo $this->baseUrl(); ?><!--/public/js/ckeditor/_samples/sample.css" />-->

            <div id="alerta" title="Alerta"></div>
            <div id="erro" title="Erro"></div>
            <div id="resultado"></div>
            <!-- ========== FIM TITULO ========== -->
            <div id="conteudo" style="align="center">
                <div id="confirmacao"></div>
                <div id="confirm"></div>
                <div class="error centro"><span></span></div>
                <form action="<?php echo $this->acao; ?>" method="post" id="frmProposta" name="frmProposta" enctype="multipart/form-data">

                    <input type="hidden" name="idPreProjeto" id="idPreProjeto" value="<?php
                    if (isset($this->proposta['idPreProjeto']))
                        echo $this->proposta['idPreProjeto'];
                    ?>">
                    <input type="hidden" name="acao" id="acao" value="<?php
                           if (isset($this->proposta['idPreProjeto'])) {
                               echo "alterar";
                           } else {
                               echo "incluir";
                           }
                    ?>">
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('identificacaodiv',$(this))" style="cursor:pointer">
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_remover.gif" class="imgDinamica"/></th>
                            <th width="95%"><a href="anc_identificacaodiv"></a>Identifica&ccedil;&atilde;o da Proposta Cultural</th>
                        </tr>
                    </table>
                    <div id="identificacaodiv" class="divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td class="esquerda" colspan="5">
                                    <div style="width: 95%">
                                        <div style="float:left; width: 85%">
                                            Proponente:
                                            <span style="color: blue;"><?php echo $this->proponente['Descricao']; ?></span>
                                            <input type="hidden" class="input_simples" name="idAgente" value="<?php
                                               if (isset($this->proponente['idAgente']))
                                                   echo $this->proponente['idAgente'];
                                                ?>">
                                        </div>
                                        <div style="float:left; width: 15%">
                                            Nr da Proposta:<br/>
                                            <span style="color: blue;">
                                                <?php
                                                   if (isset($this->proposta['idPreProjeto']))
                                                       echo $this->proposta['idPreProjeto'];
                                                ?>
                                            </span>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="esquerda">
                                <td colspan="5">Nome da Proposta Cultural *
                                    <input type="text" class="input_simples" name="nomeProjeto" id="nomeProjeto" maxlength="500" title="Nome da Proposta Cultural"  style="width:50em;" value="<?php
                                                if (isset($this->proposta['idPreProjeto']))
                                                    echo str_replace("'", "", str_replace("\"", "", ($this->proposta['NomeProjeto'])));
                                    ?>"/>
                                </td>
                            </tr>
                            <tr class="destacar centro">
                                <td colspan="5"><b>Resumo da Proposta Cultural</b></td>
                            </tr>
                            <tr>
                                <td  colspan="5">No resumo do projeto, o resumo deve descrever o que se pretende realizar, limitado ao m&aacute;ximo de 1000 caracteres. Trata-se de uma s&iacute;ntese com as informa&ccedil;&otilde;es essenciais fazendo refer&ecirc;ncia ao(s) produto(s) cadastrado(s) no Plano de Distribui&ccedil;&atilde;o.<br/> A leitura do resumo deve responder &agrave; quest&atilde;o: O QU&Ecirc;? *

                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="resumoDoProjeto" obrigatorio="1" name="resumoDoProjeto" rows="10"><?php
                                           if (isset($this->proposta['idPreProjeto']))
                                               echo $this->proposta['ResumoDoProjeto'];
                                    ?></textarea>
                                </td>
                            </tr>
                            <tr class="destacar centro">
                                <td colspan="5"><b>Informa&ccedil;&otilde;es Complementares</b></td>
                            </tr>
                            <tr>
                                <td class="centro" width="150px;" nowrap>Mecanismo: <b>Incentivo Fiscal</b></td>
                                <td class="centro">
                                    <label for="stDataFixa">Data Fixa</label>
                                    <select class="select_simples" name="stDataFixa" id="stDataFixa" style="width: 5em">
                                        <option value="0" <?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            if ($this->proposta['stDataFixa'] == "0") {
                                                echo "selected";
                                            }
                                        ?>>N&atilde;o</option>
                                        <option value="1" <?php
                                                if (isset($this->proposta['idPreProjeto']))
                                                    if ($this->proposta['stDataFixa'] == "1") {
                                                        echo "selected";
                                                    }
                                            ?>>Sim
                                        </option>
                                    </select>
                                </td>
                                <td class="centro">
                                    <label for="agenciaBancaria">Ag&ecirc;ncia Banc&aacute;ria *</label>
                                    <input type="text" class="input_simples" name="agenciaBancaria" id="agenciaBancaria" maxlength="12"  style="width:50px;"
                                           value="<?php echo $this->proposta['AgenciaBancaria']; ?>"/>
                                    <div id="ValidaAgencia" name="ValidaAgencia" style="color:#FF0000" > </div>
                                </td>
                                <td colspan="2" class="centro">
                                    <label for="propostaAudioVisual">&Eacute; proposta de audiovisual? </label>
                                    <select class="select_simples" name="propostaAudioVisual" id="propostaAudioVisual" style="width: 5em">
                                        <option value="0" <?php
                                           if (isset($this->proposta['idPreProjeto']) )
                                               if ($this->proposta['AreaAbrangencia'] == "0") {
                                                   echo "selected";
                                               }
                                            ?>>N&atilde;o
                                        </option>
                                        <option value="1" <?php
                                                if (isset($this->proposta['idPreProjeto']))
                                                    if ($this->proposta['AreaAbrangencia'] == "1") {
                                                        echo "selected";
                                                    }
                                            ?>>Sim
                                        </option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" class="">
                                    <label for="stProposta">Plano Execu&ccedil;&atilde;o Imediata</label>
                                    <select name="stProposta" id="stProposta" class="select_simples" <?php echo (!empty( $this->arquivoExecucaoImediata[0])) ? 'readonly': ''; ?>>
                                        <?php foreach ($this->listaExecucaoImediata as $key => $execucao) : ?>
                                            <option value="<?php echo $key; ?>"
                                                <?php
                                                if (isset($this->proposta['idPreProjeto']))
                                                    if ($this->proposta['stProposta'] == $key) {
                                                        echo "selected";
                                                    }
                                                ?>><?php echo $execucao; ?>
                                            </option>
                                        <?php endforeach; ?>
                                    </select>
                                    <div id="ValidaStProposta" name="ValidaStProposta" style="color:#FF0000" > </div>
                                </td>
                                <td colspan="2">
                                    <div id="comprovanteplanodeexecucao" style="display: none">
                                        <?php if( !empty( $this->arquivoExecucaoImediata[0]) ) : ?>
                                            <div id="comprovanteDocumentoAnexado" class="doc<?php echo $this->arquivoExecucaoImediata[0]['codigodocumento']; ?>">
                                                <label for="arquivo" style="width: 50px; "><?php echo $this->arquivoExecucaoImediata[0]['descricao']; ?> </label>
                                                <a href="<?php echo $this->url(array('module' => 'default', 'controller' => 'upload', 'action' => 'abrir-documentos-pre-projeto')); ?>?id=<?php echo $this->arquivoExecucaoImediata[0]['iddocumentospreprojetos']; ?>">
                                                    <?php echo $this->arquivoExecucaoImediata[0]['noarquivo']; ?>
                                                </a>
                                                <input type="button" class="btn_excluir" onclick="excluirAnexos(<?php echo $this->arquivoExecucaoImediata[0]['iddocumentospreprojetos']; ?>, <?php echo trim($this->proposta['idPreProjeto']); ?>, 'proposta', '<?php echo $currentUrl; ?>');" />
                                            </div>
                                        <?php else : ?>
                                            <div id="anexarDocumento">
                                                <label for="arquivo" style="width: 50px; ">Comprovante do Plano de Execu&ccedil;&atilde;o Imediata </label>
                                                <input type="file" name="arquivo" id="arquivo" class="input_simples">
                                                <div id="arquivoinvalido" style="color:#FF0000" ></div>
                                            </div>
                                        <?php endif; ?>
                                    </div>
                                </td>
                            </tr>
                            <tr class="destacar centro">
                                <td colspan="3"><b>Per&iacute;odo de Realiza&ccedil;&atilde;o</b></td>
                                <td colspan="2"><b>No caso de bem tombado</b></td>
                            </tr>
                            <tr>
                                <td class="centro"><label for="dtInicioDeExecucao">Data de In&iacute;cio *</label></td>
                                <td>
                                    <input type="text" name="dtInicioDeExecucao" id="dtInicioDeExecucao" maxlength="10" class="input_simples btn_calendario" value="<?php if (isset($this->proposta['idPreProjeto'])) echo $this->proposta['dtiniciodeexecucaoform']; ?>"/>
                                </td>
                                <td>
                                    <label for="tpProrrogacao">Prorroga&ccedil;&atilde;o autom&aacute;tica?</label><br>
                                    <select class="select_simples" name="tpProrrogacao" id="tpProrrogacao" style="width: 5em">
                                        <option value="1" <?php echo($this->proposta['tpProrrogacao'] == "1" ) ? "selected": ""; ?>>Sim</option>
                                        <option value="0" <?php echo($this->proposta['tpProrrogacao'] === "0") ? "selected": ""; ?>>N&atilde;o</option>
                                    </select>
                                </td>
                                <td><label for="nrAtoTombamento">N&uacute;mero do Ato </label></td>
                                <td><input type="text" class="input_simples" name="nrAtoTombamento" id="nrAtoTombamento" maxlength="12" onkeyup="ativarDesativarObrigatoriedadeDtAto()" value="<?php if (isset($this->proposta['idPreProjeto'])) echo trim($this->proposta['NrAtoTombamento']); ?>"/></td>
                            </tr>
                            <tr>
                                <td class="centro"><label for="dtFinalDeExecucao">Data Final *</label></td>
                                <td>
                                    <input type="text" name="dtFinalDeExecucao" id="dtFinalDeExecucao" maxlength="10" class="input_simples btn_calendario" value="<?php if (isset($this->proposta['idPreProjeto'])) echo $this->proposta['dtfinaldeexecucaoform']; ?>"/>
                                </td>
                                <td></td>
                                <td><label for="dtAtoTombamento">Data do Ato </label></td>
                                <td>
                                    <input type="text" name="dtAtoTombamento" id="dtAtoTombamento" maxlength="10" class="input_simples btn_calendario" readonly="readonly" value="<?php if (isset($this->proposta['idPreProjeto'])) echo $this->proposta['dtatotombamentoform']; ?>"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <span id="msgValidaData"></span>
                                    <input type="hidden" name="blnDatasValidas" id="blnDatasValidas" value="true">
                                </td>
                                <td><label for="esferaTombamento">Esfera do Ato </label></td>
                                <td><select class="select_simples" name="esferaTombamento" id="esferaTombamento" style="width: 10em">
                                        <option value="" selected>- Selecione-</option>
                                        <option value="1" <?php
                                            if (isset($this->proposta['idPreProjeto']))
                                                if ($this->proposta['EsferaTombamento'] == "1") {
                                                    echo "selected";
                                                }
                                            ?>>Municipal
                                        </option>
                                        <option value="2" <?php
                                                if (isset($this->proposta['idPreProjeto']))
                                                    if ($this->proposta['EsferaTombamento'] == "2") {
                                                        echo "selected";
                                                    }
                                            ?>>Estadual
                                        </option>
                                        <option value="3" <?php
                                                if (isset($this->proposta['idPreProjeto']))
                                                    if ($this->proposta['EsferaTombamento'] == "3") {
                                                        echo "selected";
                                                    }
                                            ?>>Federal
                                        </option>
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('objetivosdiv',$(this));" style="cursor:pointer">
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th width="95%"><a href="anc_objetivosdiv"></a>Objetivos</th>
                        </tr>
                    </table>
                    <div id="objetivosdiv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td>Os objetivos devem ser formulados com intuito de especificar aquilo que se quer atingir a partir da realiza&ccedil;&atilde;o do projeto de seus produtos finais, bem como os benef&iacute;cios da a&ccedil;&atilde;o cultural, se poss&iacute;vel, a curto, m&eacute;dio e a longo prazo. &Eacute; fundamental que os objetivos do projetos possam ser medidos quantitativamente e/ou qualitativamente;</br>
                                    </br><b>Objetivo Geral</b></br>
                                    Descreve de forma clara e precisa a ideia central da proposta e seu produto final: PARA QU&Ecirc; realizar o projeto?</br>
                                    </br><b>Objetivo Espec&iacute;fico</b></br>
                                    Elenca as diversas a&ccedil;&otilde;es que concorrem para a efetiva&ccedil;&atilde;o do objetivo geral. &Eacute; descrito de forma mais detalhada do que o objetivo geral: Qual(is) o(s) produto(s) e o(s) resultado(s) do projeto?
                                             *
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="objetivos" name="objetivos" rows="10"><?php
                                                if (isset($this->proposta['idPreProjeto']))
                                                    echo $this->proposta['Objetivos'];
                                    ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>
                    </div>
                    <!-- JUSTIFICATIVA -->
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('justificativadiv',$(this))" style="cursor:pointer">
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th width="95%"><a href="anc_justificativadiv"></a>Justificativa</th>
                        </tr>
                    </table>
                    <div id="justificativadiv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td>Inserir a justificativa do projeto, destacando os motivos para sua realiza&ccedil;&atilde;o bem como a necessidade do uso do Mecanismo Incentivo a Projetos Culturais para realiza&ccedil;&atilde;o do mesmo *</td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="justificativa" name="justificativa" rows="10"><?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            echo $this->proposta['Justificativa'];
                                        ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>
                    </div>

                    <!-- ACESSIBILIDADE -->
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('acessibilidadediv',$(this))" style="cursor:pointer" >
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th><a href="anc_acessibilidadediv"></a>Acessibilidade</th>
                        </tr>
                    </table>
                    <div id="acessibilidadediv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td><b>Na acessibilidade</b>, o proponente deve informar <b><u>quais</b></u> <b><u>a&ccedil;&otilde;es </u></b>ser&atilde;o adotadas (ou que o local j&aacute; possui), no sentido de proporcionar condi&ccedil;&otilde;es de acessibilidade a pessoas idosas, nos termos do art. 23 da Lei no 10.741, de 1º de 2003(*), e portadoras de defici&ecirc;ncia, conforme o disposto no art. 46 do Decreto no 3.298, de 20 de dezembro de 1999(**). Os projetos culturais financiados com recursos federais, inclusive oriundos de programas especiais de incentivo &agrave; cultura, deverão facilitar o livre acesso da pessoa portadora de defici&ecirc;ncia e pessoas idosas de modo a possibilitar-lhe o pleno exerc&iacute;o dos seus direitos culturais.  *</td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="acessibilidade" name="acessibilidade" rows="10"><?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            echo $this->proposta['Acessibilidade'];
                                        ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>
                    </div>

                    <!-- DEMOCRATIZACAO -->
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('democratizacaodiv',$(this))" style="cursor:pointer" >
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th width="95%">Democratiza&ccedil;&atilde;o de Acesso</th>
                        </tr>
                    </table>
                    <div id="democratizacaodiv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td><b>Na Democratiza&ccedil;&atilde;o de acesso</b>, o proponente deve inserir de forma detalhada como ser&atilde;o doados ou vendidos os ingressos e quaisquer outros produtos resultantes do projeto, com detalhamento do p&uacute;blico alva, dos pre&ccedil;o, dos crit&eacute;rios, das estrat&eacute;gias e das etapas do processo de distribui&ccedil;&atilde;o e dos resultados esperados com o acesso do p&uacute;blico. Nesse campo &eacute; essencial a identifica&ccedil;&atilde;o do p&uacute;blico-alvo quer receber&iacute; os ingressos gratuitos. *</td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="democratizacaoDeAcesso" name="democratizacaoDeAcesso" rows="10"><?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            echo $this->proposta['DemocratizacaoDeAcesso'];
                                        ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>
                    </div>

                    <!-- ETAPAS -->
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('etapasdiv',$(this))" style="cursor:pointer" >
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th width="95%">Etapas de Trabalho</th>
                        </tr>
                    </table>
                    <div id="etapasdiv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td>Enumere e descreva todas as fases do projeto, informando quando e como pretende realiz&aacute;-las. *</td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="etapaDeTrabalho" name="etapaDeTrabalho" rows="10"><?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            echo $this->proposta['EtapaDeTrabalho'];
                                        ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>
                    </div>

                    <!-- FICHA TECNICA -->
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('fichatecnicadiv',$(this))" style="cursor:pointer" >
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th width="95%">Ficha T&eacute;cnica</th>
                        </tr>
                    </table>
                    <div id="fichatecnicadiv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td><b>Na Ficha t&eacute;cnica</b>, o proponente deve informa qual ser&aacute; sua fun&ccedil;&atilde;o no projeto, assim como a indica&ccedil;&atilde;o dos nomes, juntamente com os curr&iacute;culos resumidos, do diretor/coordenador art&iacute;stico e dos artistas e/ou grupos participantes. Caso os nomes dos artistas ainda n&atilde;o estejam definidos, uma justificativa pela falta dos mesmos faz-se necess&aacute;ria. *</td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="fichaTecnica" name="fichaTecnica" rows="10"><?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            echo $this->proposta['FichaTecnica'];
                                        ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>
                    </div>

                    <!-- SINOPSE -->
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('sinopsediv',$(this))" style="cursor:pointer" >
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th width="95%">Sinopse da obra</th>
                        </tr>
                    </table>
                    <div id="sinopsediv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td>Inserir o conte&uacute;do de todos os produtos do projeto que necessitam de um breve resumo em rela&ccedil;&atilde;o ao seu assunto. Como, por exemplo: semin&aacute;rios, palestras, livros, peri&oacute;dicos, espet&aacute;culo de circo, pe&ccedil;a teatral, espet&aacute;culo de dan&ccedil;a, performance de outra natureza, entre outros. *</td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="sinopse" name="sinopse" rows="10"><?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            echo $this->proposta['Sinopse'];
                                        ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>
                    </div>
                    <!-- IMPACTO AMBIENTAL -->
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('impactodiv',$(this))" style="cursor:pointer" >
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th width="95%">Impacto Ambiental</th>
                        </tr>
                    </table>
                    <div id="impactodiv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td>Inserir as especifica&ccedil;&otilde;es t&eacute;cnicas de todos os produtos do projeto que necessitam desse datalhamento. Ou seja, especifica&ccedil;&otilde;es t&eacute;cnicas das pe&ccedil;as gr&aacute;ficas, do s&iacute;tio de internet, dos workshops com curta dura&ccedil;&atilde;o e dos cursos de longa dura&ccedil;&atilde;o (projeto pedag&oacute;gico), entre outros. *</td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="impactoAmbiental" name="impactoAmbiental" rows="10"><?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            echo $this->proposta['ImpactoAmbiental'];
                                        ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>
                    </div>

                    <!-- ESPECIFICAO -->
                    <table class="tabela">
                        <tr onclick="javascript:JSMostraOcultaObj('especificacaodiv',$(this))" style="cursor:pointer" >
                            <th width="5%" align="center"><img src="<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif" class="imgDinamica"/></th>
                            <th width="95%">Especifica&ccedil;&otilde;es t&eacute;cnicas do produto</th>
                        </tr>
                    </table>
                    <div id="especificacaodiv" class="sumir divChave">
                        <table class="tabela" cellpadding="1" cellspacing="1">
                            <tr>
                                <td>
                                    <p>Inserir as especifica&ccedil;&otilde;es t&eacute;cnicas de todos os produtos do projeto que necessitam desse datalhamento. Ou seja, especifica&ccedil;&otilde;es t&eacute;cnicas das pe&ccedil;as gr&aacute;ficas, do s&iacute;tio de internet, dos workshops com curta dura&ccedil;&atilde;o e dos cursos de longa dura&ccedil;&atilde;o (projeto pedag&oacute;gico), entre outros. *</p>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- ========== EDITOR ========== -->
                                    <textarea cols="80" id="especificacaoTecnica" name="especificacaoTecnica" rows="10"><?php
                                        if (isset($this->proposta['idPreProjeto']))
                                            echo $this->proposta['EspecificacaoTecnica'];
                                        ?>
                                    </textarea>
                                </td>
                            </tr>
                            <tr>
                                <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                            </tr>
                        </table>

                <table class="tabela" cellpadding="1" cellspacing="1">
                    <tr>
                        <th>Outras Informa&ccedil;&otilde;es</th>
                    </tr>
                    <tr>
                        <td>
                            <p>Apenas utilizar este campo caso tenha informa&ccedil;&atilde;o complementar do projeto que n&atilde;o tenha sido abordada nos campos anteriores. Como, por exemplo, algum apontamento acerca de rubricas no or&ccedil;amento da Planilha Or&ccedil;ament&aacute;ria.</p>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <!-- ========== EDITOR ========== -->
                            <textarea cols="80" id="informacoes" name="informacoes" rows="10"><?php
                                if (isset($this->proposta['idPreProjeto']))
                                    echo $this->proposta['EstrategiadeExecucao'];
                            ?>
                            </textarea>
                        </td>
                    </tr>
                    <tr>
                        <td><span style="color: #ff5050;">Limite m&aacute;ximo de 8000 caracteres.</span></td>
                    </tr>
                </table>
            </div>
            <br>
            <div align="center">
                <span id="msgForm" style="font-color:red;"></span>
                <input type="submit" class="btn_salvar" id="btn_salvar" value="">
                <!-- <input id="btn_sair" type="button" value=" " name="sair" class="btn_sair" style="cursor: pointer;" onclick="window.location='<?php //echo $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaincentivofiscal', 'action' => 'index'));         ?>';" /> -->
            </div>
        </form>
        <br/>
    </div>
</div>
    <div id="rodapeConteudo"><span></span></div>
    <br clear="all" />

<script>

    // funcao para excluir os anexos
    function excluirAnexos(idArquivo, idPreProjeto, tipoDocumento, request)
    {
        url = '<?php echo $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaedital', 'action' => 'excluiranexo')) ?>?idArquivo=' + idArquivo + '&idPreProjeto=' + idPreProjeto + '&tipoDocumento=' + tipoDocumento + '&request=' + request;
        confirmModal('CONFIRMA&Ccedil;&Atilde;O', 'msgExclusaoArq', 320, 200, null, url);
    }
</script>


<script type="text/javascript">
    $(document).ready(function(){

        <?php if (!$this->isEditavel) : ?>
        //DESABILITA ALTERACOES NOS DADOS DO FORMULARIO (INCLUIR/ALTERAR/EXCLUIR)
        JSBloquearAlteracaoFormulario();
        <?php endif; ?>

        $("#nrAtoTombamento").numeric();

        //VALIDA CAMPO RESUMO DA PROPOSTA
        jQuery.validator.addMethod("validarResumoDoProjeto", function(value, element)
        {
            var texto = CKEDITOR.instances['resumoDoProjeto'].getData().toString().replace(/(<.*?>)|(&nbsp;)|(\s+)/g,'');

            if (texto.length > 0)
            {
                $('#resumoDoProjeto').val(CKEDITOR.instances['resumoDoProjeto'].getData());
                return true;
            }

            return false;
        });

        //VALIDA CAMPO RESUMO DA PROPOSTA Menor que 1000 caracteres
        jQuery.validator.addMethod("validarResumoDoProjeto1000", function(value, element)
        {
            var texto = CKEDITOR.instances['resumoDoProjeto'].getData().toString().replace(/(<.*?>)|(&nbsp;)|(\s+)/g,'');

            if (texto.length > 1000)
            {
                return false;
            }

            $('#resumoDoProjeto').val(CKEDITOR.instances['resumoDoProjeto'].getData());
            return true;
        });

        $("#frmProposta").validate({
            rules: {
                nomeProjeto: { required: true },
                resumoDoProjeto: { validarResumoDoProjeto: true, validarResumoDoProjeto1000:  true },
                agenciaBancaria: { required:  true },
                dtInicioDeExecucao: { required: true, minlength: 10 },
                dtFinalDeExecucao: { required: true, minlength: 10 },
                stProposta: { required: true}
            },
            messages: {
                nomeProjeto: { required: function(){ return "<br>Dado obrigat&oacute;rio n&atilde;o informado" } },
                resumoDoProjeto: {
                    required: function(){ return "<br>Dado obrigat&oacute;rio n&atilde;o informado" },
                    validarResumoDoProjeto: function(){ return "Dado obrigat&oacute;rio n&atilde;o informado" },
                    validarResumoDoProjeto1000: function(){ return "Dado obrigat&oacute;rio n&atilde;o informado 1000" }
                },
                agenciaBancaria: { required: function(){ return "<br>Dado obrigat&oacute;rio n&atilde;o informado" } },
                dtInicioDeExecucao: {
                    required: function(){ return "<br>Dado obrigat&oacute;rio n&atilde;o informado" },
                    minlength: function(){ return "<br>Data in&iacute;cio inv&aacute;lida" }
                },
                dtFinalDeExecucao: {
                    required: function(){ return "<br>Dado obrigat&oacute;rio n&atilde;o informado" },
                    minlength: function(){ return "<br>Data final inv&aacute;lida" }
                },
                stProposta: { required: function() { return "<br>A data da criacão da proposta não pode ultrapassar 30/09 do ano anterior a execução do projeto." }} //@todo novaIn
            },
            submitHandler: function(form) {
                validaAgencia();
//                AgenciaValida = document.getElementById("ValidaAgencia").innerHTML;
//                if(AgenciaValida != ''){
//                    $('#tabs').tabs('select', 'identificacao');
//                    $("#agenciaBancaria").focus();
//                    document.getElementById("ValidaAgencia").innerHTML = "<Br>Ag&ecirc;ncia inv&aacute;lida";
////                    JSMostraOcultaObj('identificacao');
//                }else{
//                    document.getElementById("ValidaAgencia").innerHTML = "";
//                }


                //se datas nao atendem as regras de negocio, nao submete o form
                if($("#blnDatasValidas").val() == "false"){
                    $('#tabs').tabs('select', 'identificacaodiv');
                    $("#dtInicioDeExecucao").focusin();
                    return false;
                }
                //valida qtde de digitos da data
//                if($("#dtInicioDeExecucao").val().length < 10){
//                    $('#tabs').tabs('select', 'identificacaodiv');
//                    $("#msgValidaData").html("<font color='red'>Data in&iacute;cio inv&aacute;lida</font>");
//                    $("#msgValidaData").focus();
//                    return false;
//                }
                //valida qtde de digitos da data
//                if($("#dtFinalDeExecucao").val().length < 10){
//                    $('#tabs').tabs('select', 'identificacaodiv');
//                    $("#msgValidaData").html("<font color='red'>Data final inv&aacute;lida</font>");
//                    $("#msgValidaData").focus();
//                    return false;
//                }
                //valida qtde de digitos da data
                if($("#nrAtoTombamento").val() != "" && $("#dtAtoTombamento").val().length < 10){
                    $('#tabs').tabs('select', 'identificacaodiv');
                    $("#msgValidaData").html("<font color='red'>Data tombamento inv&aacute;lida</font>");
                    $("#msgValidaData").focusin();
                    return false;
                }
                //valida data do ano anual
                if ($("#stProposta").val() == '4' && $("#dtInicioDeExecucao").val().length == 10){
                    ano_vigente = <?php echo date('Y')?>;
                    ano_execucao    = new Number($('#dtInicioDeExecucao').val().substr(6, 4));
                    if (ano_vigente >= ano_execucao) {
//                        JSMostraOcultaObj('identificacaodiv');
                        $("#ValidaStProposta").html("<font color='red'>O per&iacute;odo de execu&ccedil;&atilde;o de projetos de plano anual dever ser posterior ao ano vigente</font>");
                        $("#dtInicioDeExecucao").focusin();
                        return false;

                    }else{
                        $("#ValidaStProposta").html("");
                    }

                }else{
                    $("#ValidaStProposta").html("");
                }

                form.submit();

            },invalidHandler: function(event, validator) {

                var errors = validator.numberOfInvalids();
                if (errors) {
                    var message = errors == 1
                        ? 'Voc&ecirc; possui 1 campo com erro. Ele foi destacado abaixo'
                        : 'Voc&ecirc; possui ' + errors + ' campos com erros. Eles foram destacados abaixo';
                    $("div.error span").html(message);
                    $("div.error").show();
                    JSMostraOcultaObj('identificacaodiv', null, true);

                } else {
                    $("div.error").hide();
                }
            }

        });

        $("#stProposta").change(function() {

            if($(this).val() == 618 || $(this).val() == 619 ){
                $("#comprovanteplanodeexecucao").show();
                $("#comprovanteplanodeexecucao #arquivo").removeAttr('disabled');
            }else {
                $("#comprovanteplanodeexecucao").hide();
                $("#comprovanteplanodeexecucao #arquivo").attr('disabled','disabled');
            }
        });

        if( $("#stProposta").val() == 618 ||  $("#stProposta").val() == 619 ) {
            $("#comprovanteplanodeexecucao").show();
            $("#comprovanteplanodeexecucao #arquivo").removeAttr('disabled');
        }

//    $("#solicitarvinculo").click(function(){
//        $("#confirmacao").dialog({
//            resizable: true,
//            width:450,
//            height:150,
//            modal: true,
//            autoOpen:false,
//            closeOnEscape : false,
//            title : 'Alerta',
//            buttons: {
//                'Nao': function(){
//                    $(this).dialog('close');
//                },
//                'Sim': function(){
//                    $.ajax({
//                        async: true,
//                        dataType: 'json',
//                        type: "post",
//                        url: "<?php //echo $this->url(array('controller' => 'vincularresponsavel', 'action' => 'vinculo')); ?>//",
//                        data:{
//                            solicitarvinculoproposta : '1' <?php //if (isset($_GET['idPreProjeto'])) { ?>//,idPreProjeto : '<?php //echo $_GET['idPreProjeto'] ?>//'<?php //} ?>
//                        },
//                        success: function(data)
//                        {
//                            $("#confirmacao").dialog("close")
//                            if(!data.error){
//                                confirma('Sua solicita&ccedil;&atilde;o foi enviada com sucesso.',
//                                function(){
//                                    $("#solicitarvinculo").remove();
//                                    $("#confirm").dialog("close")
//                                }
//                            )
//                            }
//                            else{
//                                confirma('Falha na recupera&ccedil;&atilde;o dos dados!',
//                                function(){
//                                    $("#confirm").dialog("close")
//                                }
//                            )
//                            }
//                        }
//                    });
//                }
//            }
//        });
//        $("#confirmacao").html('Tem certeza que deseja enviar a solicita&ccedil;&atilde;o para o proponente?')
//        $("#confirmacao").dialog("open")
//    })

        $("#dtInicioDeExecucao").change(function()
        {
            if($(this).val().length == 10){
                var url = '<?php echo $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaincentivofiscal', 'action' => 'valida-datas')); ?>';
                url = url +'?dtInicio='+$("#dtInicioDeExecucao").val()+'&dtFim='+$("#dtFinalDeExecucao").val();
                //funcao responsavel acessar a url via ajax e retornar os dados para o local indicado
                jqAjaxLinkSemLoading(url,'','msgValidaData');
            }
        });

        $("#dtFinalDeExecucao").change(function()
        {
            var url = '<?php echo $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaincentivofiscal', 'action' => 'valida-datas')); ?>';
            url = url +'?dtInicio='+$("#dtInicioDeExecucao").val()+'&dtFim='+$("#dtFinalDeExecucao").val();
            //funcao responsavel acessar a url via ajax e retornar os dados para o local indicado
            jqAjaxLinkSemLoading(url,'','msgValidaData');
        });

        $("#dtAtoTombamento").change(function()
        {
            var url = '<?php echo $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaincentivofiscal', 'action' => 'valida-datas')); ?>';
            url = url +'?nrAto='+$("#nrAtoTombamento").val()+'&dtAto='+$("#dtAtoTombamento").val();
            //funcao responsavel acessar a url via ajax e retornar os dados para o local indicado
            jqAjaxLinkSemLoading(url,'','msgValidaData');
        });

        CKEDITOR.config.fontSize_sizes = '14/14px;16/16px;18/18px;20/20px;22/22px;24/24px;26/26px;';
        //   CKEDITOR.config.blockedKeystrokes = [CKEDITOR.CTRL + 86]; /* Bloqueando tecla Ctrl+V */
//    CKEDITOR.replaceAll();
//
        CKEDITOR.replace( 'resumoDoProjeto', { toolbar: [] } );
        CKEDITOR.replace( 'objetivos', { toolbar: [] } );
        CKEDITOR.replace( 'justificativa', { toolbar: [] } );
        CKEDITOR.replace( 'acessibilidade', { toolbar: [] } );
        CKEDITOR.replace( 'democratizacaoDeAcesso', { toolbar: [] } );
        CKEDITOR.replace( 'etapaDeTrabalho', { toolbar: [] } );
        CKEDITOR.replace( 'fichaTecnica', { toolbar: [] } );
        CKEDITOR.replace( 'sinopse', { toolbar: [] } );
        CKEDITOR.replace( 'impactoAmbiental', { toolbar: [] } );
        CKEDITOR.replace( 'especificacaoTecnica', { toolbar: [] } );
        CKEDITOR.replace( 'informacoes', { toolbar: [] } );

        $('#agenciaBancaria').blur(function(){
            validaAgencia()
        });

        <?php if (!empty($this->proposta->agenciabancaria)): ?>
        validaAgencia();
        <?php endif; ?>

        $("#nomeProjeto").keyup(function()
        {
            var novoValor = $(this).val().replace("'","");
            $(this).val(novoValor);
            var novoValor = $(this).val().replace("\"","");
            $(this).val(novoValor);
        });

        function ativarDesativarObrigatoriedadeDtAto()
        {
            //SE NUMERO DO ATO DIFERENTE DE VAZIO, A DATA E OBRIGATORIA
            if($("#nrAtoTombamento").val() != "")
            {
                //REGRAS E MENSAGENS PARA OS CAMPOS CRIADOS
                $("#dtAtoTombamento").rules("add", {
                    required: true,
                    messages: {required: "<br>Data tombamento inv&aacute;lida"}
                });
                $("#esferaTombamento").rules("add", {
                    required: true,
                    messages: {required: "<br>Esfera inv&aacute;lida"}
                });

            }else{
                $("#dtAtoTombamento").rules("remove");
                $("#esferaTombamento").rules("remove");
            }
        }
//    function confirma(msg, functionok){
//        $("#confirm").html(msg)
//        $("#confirm").dialog({
//            resizable: true,
//            width:450,
//            height:150,
//            modal: true,
//            autoOpen:false,
//            closeOnEscape : false,
//            title : 'Alerta',
//            buttons: {
//                'OK': functionok
//            }
//        });
//        $("#confirm").dialog('open');
//    }
//    function verificaDatas()
//    {
//        var url = '<?php //echo $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaincentivofiscal', 'action' => 'valida-datas')); ?>//';
//        url = url +'?dtInicio='+$("#dtInicioDeExecucao").val()+'&dtFim='+$("#dtFinalDeExecucao").val();
//        //funcao responsavel acessar a url via ajax e retornar os dados para o local indicado
//        jqAjaxLinkSemLoading(url,'','msgValidaData');
//
//        var url = '<?php //echo $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaincentivofiscal', 'action' => 'valida-datas')); ?>//';
//        url = url +'?dtInicio='+$("#dtInicioDeExecucao").val()+'&dtFim='+$("#dtFinalDeExecucao").val();
//        //funcao responsavel acessar a url via ajax e retornar os dados para o local indicado
//        jqAjaxLinkSemLoading(url,'','msgValidaData');
//
//        var url = '<?php //echo $this->url(array('module' => 'proposta', 'controller' => 'manterpropostaincentivofiscal', 'action' => 'valida-datas')); ?>//';
//        url = url +'?nrAto='+$("#nrAtoTombamento").val()+'&dtAto='+$("#dtAtoTombamento").val();
//        //funcao responsavel acessar a url via ajax e retornar os dados para o local indicado
//        jqAjaxLinkSemLoading(url,'','msgValidaData');
//    }

        function validaAgencia(){
            //agencia = $('#agenciaBancaria').val().replace(" ","");
            $("#ValidaAgencia").html("validando informa&ccedil;&atilde;o...");
            jqAjaxLinkSemLoading('<?php echo $buscarAgencia; ?>?agencia='+$('#agenciaBancaria').val(), "", "ValidaAgencia");
        }

        // mascaras dos campos
        $("#dtInicioDeExecucao, #dtFinalDeExecucao, #dtAtoTombamento").keyup(function()
        {
            mascara(this, format_data); // data
        });

        // calendario
        $.datepicker.regional['pt-BR'] =
        {
            closeText: 'Fechar',
            prevText: '&#x3c;Anterior',
            nextText: 'Pr&oacute;ximo&#x3e;',
            currentText: 'Hoje',
            monthNames: ['Janeiro','Fevereiro','Mar&ccedil;o','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
            monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
            dayNames: ['Domingo','Segunda-feira','Ter&ccedil;a-feira','Quarta-feira','Quinta-feira','Sexta-feira','S&aacute;bado'],
            dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','Sab'],
            dayNamesMin: ['Dom','Seg','Ter','Qua','Qui','Sex','Sab'],
            weekHeader: 'Sm',
            dateFormat: 'dd/mm/yy',
            firstDay: 0,
            isRTL: false,
            showMonthAfterYear: false,
            yearSuffix: ''
        };
        $.datepicker.setDefaults($.datepicker.regional['pt-BR']);

        // id dos campos que utilizarï¿½o o calendï¿½rio
        $("#dtInicioDeExecucao, #dtFinalDeExecucao, #dtAtoTombamento").datepicker($.datepicker.regional['pt-BR']);


    });

    /* -----
     FUNcao QUE FAZ A TROCA (VISUAL) DE UM OBJETO NA TELA
     CASO ID_STATUS SEJA UM, O OBJETO ANTERIOR NAO SERIA RETIRADO DA TELA
     DENTRO DA FUNCAO ABAIXO ELE TAMBEM ALTERA OS DADOS CONFORME A MUDANCA NO DISPLAY
     --------- */
    //function JSMostraOcultaObj(id_tbl,id_status){
    function JSMostraOcultaObj(idObjConteudo,obj, show){

        aparece = $('#'+idObjConteudo).css('display');

        if(show) aparece = 'none';

        $('#conteudo').find('.divChave').each(function(){
            $(this).hide();
            $(this).fadeOut('fast', function() {
                $('img.imgDinamica').attr('src','<?php echo $this->baseUrl(); ?>/public/img/btn_adicionar.gif');
            });
        });
        if(aparece != 'block'){
            $("#"+idObjConteudo).fadeIn('fast', function() {
                $('img', $(obj)).attr('src','<?php echo $this->baseUrl(); ?>/public/img/btn_menos.gif');
                if(obj){
                    $('html, body').animate({
                        scrollTop: $(obj).offset().top
                    }, 1000);
                }
            });
        }
    }

</script>
